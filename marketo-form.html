<!DOCTYPE html>
<html>
<head>
	<title>Test Marketo</title>
<script async type = "text/javascript" >
    (function() {
        var didInit = false;

        function initMunchkin() {
            if (didInit === false) {
                didInit = true;
                Munchkin.init('301-ZGZ-364');
            }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
            if (this.readyState == 'complete' || this.readyState == 'loaded') {
                initMunchkin();
            }
        };

        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
    })();

</script>	
</head>
<body>

<script src="//mktg.billtrust.com/js/forms2/js/forms2.min.js"></script> 
<form id="mktoForm_4424"></form> 
<script>MktoForms2.loadForm("//mktg.billtrust.com", "301-ZGZ-364", 4424);</script>

<!-- Marketo Script to hide form and display confirmation message -->
<script type="application/javascript">
MktoForms2.whenReady(function (form) {
	var formEl = form.getFormElem()[0];
	if (formEl.getAttribute("data-inline-behaviors-loaded") == "true") {
	  return;
	}
	formEl.setAttribute("data-inline-behaviors-loaded", "true");
	// now continue
	form.onSuccess(function (values, followUpUrl) {
	  //get the form's element and hide it
	  form.getFormElem().hide();
	  //capture UTMs
	  form.getFormElem()[0].classList.add("submitted");
	  //get the form's element and show it
	  var thanksText = document.getElementsByClassName("form-msg")[0];
	  thanksText.style.display = "block";
	  //return false to prevent the submission handler from taking the lead to the follow up url.
	  return false;
	});

let initialValues = mktoForm.getValues();
  
  if("Phone" in initialValues) {
    mktoForm.onValidate(validatePhone);
  }

  function validatePhone(nativeValid) {
    if (!nativeValid) return;

    let fieldName = "Phone",
        currentValue = mktoForm.getValues()[fieldName],
        elJq = mktoForm.getFormElem().find("#" + fieldName),
        limits = {
          minDigits: 7,
          maxDigits: 10
        },
        messages = {
          INVALID_CHARACTERS: 'Phone numbers may only have digits, spaces, and the characters + - . ( )',
          INVALID_DIALABLE_LENGTH: 'Phone numbers must have between ' +
          limits.minDigits + ' and ' +
          limits.maxDigits + ' digits'
        };

    mktoForm.submittable(false);

    if (currentValue.match(/[^0-9+\-.() ]/g)) {
      mktoForm.showErrorMessage(messages.INVALID_CHARACTERS, elJq);
      return false;
    } else if (currentValue.match(/\d/g).length < limits.minDigits ||
      currentValue.match(/\d/g).length > limits.maxDigits) {
      mktoForm.showErrorMessage(messages.INVALID_DIALABLE_LENGTH, elJq);
      return false;
    }

    mktoForm.submittable(true);
  }
  
});
</script>

<script>
  if (typeof MktoForms2 !== 'undefined') {
    MktoForms2.whenReady(function (form) {
      form.onSuccess(function() {
        dataLayer.push({
          'event': 'marketoFormSubmit',
          'mktoID': form.getId()
        });
      });
    });
  }
</script>

<!-- Hidden content - confirmation content to display after form submitted -->
<div class="form-msg">
    <p>Thank you for contacting iController. Weâ€™ll reach out to you asap to schedule a free demo.</p>
</div>

<!-- Styles to hide confirmation content until form is submitted -->
<style>
  .form-msg {display:none;}
  body {background-color: #999;}
</style>

<p><a href="https://dwill530.github.io/">Home page</a></p>

</body>
</html>